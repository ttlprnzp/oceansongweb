<!doctype html>
<html>

<head>
    <title>Sing me the Ocean Song</title>
    <meta charset="utf-8" />
</head>

<style>
    * {
      box-sizing: border-box;
    }
    
    body {
      background-color: #ffffff;
      font-family: monospace;
      font-size: 12px;
      text-shadow: 1px 1px #ffffff;
    }

    canvas {
      width: 100%;
      height: 100%;
      margin: 0px;
      border: 0;
      background-attachment:fixed;
      overflow: hidden; 
      display: block; 
      z-index: -2;
    }

    #info {
        width:100%;
        position:fixed;
        text-align:left;
        margin: 0;
    }

    h1 {
        font-size: 4rem;
    }

    h2 {
        font-size: 1.5rem;
        padding: 1rem;
        margin: auto;
    }

    h3 {
        font-size: 1.5rem;
    }

    p {
        width:30%;
        font-size: 1.5rem;
        z-index: 1;
        margin: 1%;
    }

    #test {
        height: 50vh;
        position:fixed;
        width:100%;
        vertical-align: middle;
        margin: 16vh auto;
        text-align:center;
    }

    .qcontainer{
        position: relative;
        align-items:stretch;
        width: 50%;
        height: 12vh;
        margin: auto;
    }
    
    .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        margin: auto; 
        height: 15px;
        outline: none;
        background: #eeeeee;
        opacity: 0.6; 
        -webkit-transition: .2s; 
        transition: opacity .2s;
    }

    .slider:hover {
        opacity: 0.8; 
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none; 
        appearance: none;
        width: 20px; 
        height: 15px; 
        background: #000000;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 20px; 
        height: 15px;
        background: #000000; 
        cursor: pointer; 
    }

    .sliderticks {
        display: flex;
        justify-content:space-between;
        padding: 0 10px;
        font-size:16px
    }

    .sliderticks p {
        position: relative;
        display: flex;
        white-space: nowrap;
        justify-content: center;
        overflow:visible;
        width: 2px;
        background: #000000;
        height: 10px;
        line-height: 50px;
        margin: 0 0 20px 0;
        font-size:1em;
    }
    
    .tab {
      display: none;
    }
    
    button {
      background-color: #000000;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      font-size: 1.5rem;
      z-index: 2;
      cursor: pointer;
    }
    
    button:hover {
      opacity: 0.8;
    }
    
    .step {
      height: 15px;
      width: 15px;
      background-color: #000000;
      border: none;  
      border-radius: 50%;
      display: inline-block;
      text-align: center;
      opacity: 0.5;
    }
    
    .step.active {
      opacity: 1;
    }
    
</style>

<body>
    <canvas id='myCanvas' style='position:fixed; left:0px; top:0px;'></canvas>

    <div id="wrapper">

        <div id="info">
            <h3>Andreas Sommer</h3>
            <h1>OCEAN SONG</h1>
          
            <div class="tab">
                <p>Have you ever wondered what your personality sounds like? How your self and being transcend into the sonic realm? With the help of state-of-the-art psychological methods and innovations in artistic research this website allows you to listen in on yourself and compose your very own Ocean Song.
                </br>
                </br> 
                On the following pages you will be presented with 20 statements about yourself that you are kindly asked to answer to the best of your experience and self-knowledge. Please answer the questions according to how you faithfully think you are, not how you would like to be! When proceeding to the next page, you will be asked to grant permission to use your microphone, to also incorporate aspects of your current sonic existence into the analysis.
                </p>
            </div>
        </div>
        
            <div id="test">

                <div class="tab">
                    
                    <div class="qcontainer">
    <!-- Question 1 -->
                        <h2>I am the life of the party.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="extra" name="q1" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                    
                    <div class="qcontainer">
    <!-- Question 2 -->
                        <h2>I sympathize with others' feelings.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="agree" name="q2" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 3 -->
                        <h2>I get chores done right away.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="consc" name="q3" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 4 -->
                        <h2>I have frequent mood swings.</h2>
                        
                        <input type="range" min="1" max="5" value="3" class="slider" id="neuro" name="q4" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 5 -->
                        <h2>I have a vivid imagination.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="open" name="q5" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                </div>
            

                <div class="tab">
                    
                    <div class="qcontainer">
    <!-- Question 6 -->
                        <h2>I don't talk a lot.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="extra" name="q6" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                    
                    <div class="qcontainer">
    <!-- Question 7 -->
                        <h2>I am not interested in other people's problems.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="agree" name="q7" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 8 -->
                        <h2>I often forget to put things back in their proper place.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="consc" name="q8" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 9 -->
                        <h2>I am relaxed most of the time.</h2>
                        
                        <input type="range" min="1" max="5" value="3" class="slider" id="neuro" name="q9" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 10 -->
                        <h2>I am not interested in abstract ideas.</h2>
                        
                        <input type="range" min="1" max="5" value="3" class="slider" id="open" name="q10" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                </div>

                <div class="tab">
                    
                    <div class="qcontainer">
    <!-- Question 11 -->
                        <h2>I talk to a lot of different people at parties.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="extra" name="q11" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                    
                    <div class="qcontainer">
    <!-- Question 12 -->
                        <h2>I feel others' emotions.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="agree" name="q12" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 13 -->
                        <h2>I like order.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="consc" name="q13" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 14 -->
                        <h2>I get upset easily.</h2>
                        
                        <input type="range" min="1" max="5" value="3" class="slider" id="neuro" name="q14" placeholder="0">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 15 -->
                        <h2>I have difficulty understanding abstract ideas.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="open" name="q15" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                </div>

                <div class="tab">
                    
                    <div class="qcontainer">
    <!-- Question 16 -->
                        <h2>I keep in the background.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="extra" name="q16" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                    
                    <div class="qcontainer">
    <!-- Question 17 -->
                        <h2>I am not really interested in others.</h2>

                        <input type="range" min="1" max="5" value="3" class="slider" id="agree" name="q17" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 18 -->
                        <h2>I make a mess of things.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="consc" name="q18" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 19 -->
                        <h2>I seldom feel blue.</h2>
                        
                        <input type="range" min="1" max="5" value="3" class="slider" id="neuro" name="q19" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>

                    <div class="qcontainer">
    <!-- Question 20 -->
                        <h2>I do not have a good imagination.</h2>
                    
                        <input type="range" min="1" max="5" value="3" class="slider" id="open" name="q20" placeholder="1">
                            <div class="sliderticks">
                                <p>Very Inaccurate</p>
                                <p></p>
                                <p></p>
                                <p></p>
                                <p>Very Accurate</p>
                            </div>
                    </div>
                </div>                                    
        </div>                

        <div id="info">
            <h3>Andreas Sommer</h3>
            <h1>OCEAN SONG</h1>
            <div class="tab">
                <p>Your data has successfully been processed and evaluated. 
                </br>Once you hit submit, your individually composed Ocean Song will play for you for three minutes.</p>
            </div>
        </div>

        <div style="position:fixed; bottom:1%; width:100%;text-align:center">
            <div style="position:fixed; bottom:5%; left: 80%">
                    <button type="button" id="start" onclick="startThings(1)">Start</button>
                    <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
                    <button type="button" id="submit">Submit</button>
                    <button type="button" id="reset" onclick="location.reload()">Reset</button>
            </div>
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
        </div>
    </div>
</body>

<script type="module" src="Tone.js"></script>


<script>
    let currentTab = 0;
    let page1 = [0,0,0,0,0];
    let page2 = [0,0,0,0,0];
    let page3 = [0,0,0,0,0];
    let page4 = [0,0,0,0,0];
    let qValues = [page1, page2, page3, page4] 
    
    const pages = document.getElementsByClassName("tab")

    showTab(currentTab); 
    
    async function startThings(n) {
        pages[n].style.display = "block";
        await Tone.start();
            console.log("läuft")
            var mic = new Tone.UserMedia(10);
            mic.open()
        pages[currentTab].style.display = "none";
        currentTab = currentTab + n;
        showTab(currentTab);
    }

    function showTab(n) {
        pages[n].style.display = "block";
        //... and fix the Previous/Next buttons:
        if (n == 0) {
            document.getElementById("start").style.display = "inline";
            document.getElementById("nextBtn").style.display = "none";
            document.getElementById("submit").style.display = "none";
            document.getElementById("reset").style.display = "none";
        } else {
            document.getElementById("start").style.display = "none";
            document.getElementById("nextBtn").style.display = "inline";
        }
        if (n == (pages.length-1)) {
            document.getElementById("submit").style.display = "inline";
            document.getElementById("nextBtn").style.display = "none";
        } 
        fixStepIndicator(n)
    }
    
    function pushAnswers(cTab) {
        let choices = pages[cTab].getElementsByTagName('input');
            console.log(choices[1].value);
            for (i=0; i < choices.length; i++) {
                if (choices[i].placeholder == 1) {
                    if (choices[i].id == 'open') {
                        qValues[cTab-1][0] = (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'consc') {
                        qValues[cTab-1][1] = (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'extra') {
                        qValues[cTab-1][2] = (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'agree') {
                        qValues[cTab-1][3] = (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'neuro') {
                        qValues[cTab-1][4] = (6-parseInt(choices[i].value));
                    }
                } else {
                    if (choices[i].id == 'open') {
                        qValues[cTab-1][0] = parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'consc') {
                        qValues[cTab-1][1] = parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'extra') {
                        qValues[cTab-1][2] = parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'agree') {
                        qValues[cTab-1][3] = parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'neuro') {
                        qValues[cTab-1][4] = parseInt(choices[i].value);
                    }
                };
            }
            console.log(qValues[currentTab-1]);
            shape(qValues[currentTab-1], radius/5, 1, angle, 2);
        }

    function nextPrev(n) {            
        pushAnswers(currentTab);
        pages[currentTab].style.display = "none";
        currentTab = currentTab + n;
        showTab(currentTab);
        if (currentTab == 5) {
            tabulateAnswers()
        } 
    }
    
  
    function fixStepIndicator(n) {
        let i, steps = document.getElementsByClassName("step");
        for (i = 0; i < steps.length; i++) {
        steps[i].className = steps[i].className.replace("active", "");
        } 
        steps[n].className += " active";
    }
    
    let Oscore = 0, Cscore = 0, Escore = 0, Ascore = 0, Nscore = 0;
    
    //document.getElementById("submit").onclick =
    function tabulateAnswers() {
        let choices = document.getElementsByTagName("input");
            for(i=0; i<choices.length; i++) {
                if (choices[i].placeholder == 1) {
                    if (choices[i].id == 'open') {
                        Oscore = Oscore + (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'consc') {
                        Cscore = Cscore + (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'extra') {
                        Escore = Escore + (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'agree') {
                        Ascore = Ascore + (6-parseInt(choices[i].value));
                    }
                    if (choices[i].id == 'neuro') {
                        Nscore = Nscore + (6-parseInt(choices[i].value));
                    }
                } else {
                    if (choices[i].id == 'open') {
                        Oscore = Oscore + parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'consc') {
                        Cscore = Cscore + parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'extra') {
                        Escore = Escore + parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'agree') {
                        Ascore = Ascore + parseInt(choices[i].value);
                    }
                    if (choices[i].id == 'neuro') {
                        Nscore = Nscore + parseInt(choices[i].value);
                    }
                }
            }
            console.log(Oscore, Cscore, Escore, Ascore, Nscore)
            return Oscore, Cscore, Escore, Ascore, Nscore 
    }
</script>

<script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    let angle = 2*Math.PI/5;
    let radius = 0
    let move = angle


    function initialize() {
        window.addEventListener('resize', resizeCanvas, false);
        resizeCanvas();
    }


    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let x = ctx.canvas.width/2;
        let y = ctx.canvas.height/2;
        ctx.translate(x, y);
        if (canvas.width <= canvas.height){
            radius = 0.45*canvas.width
        } else {
            radius = 0.45*canvas.height
        }
        console.log(radius)
        
        if (currentTab <= 5) {
            setBackground();
            if (currentTab >= 2) {
                for (i=1; i<=currentTab; i++) {
                    shape(qValues[i-1], radius/5, 1, angle, 2);
                }
            }
        }
    }
    resizeCanvas();
    initialize()

    let size = radius/5

    function background(radius, alpha, angle, fade) {
        ctx.fillStyle = 'rgba(255, 255, 255, '+fade+')';
        ctx.fillRect(-ctx.canvas.width/2,-ctx.canvas.height/2, ctx.canvas.width, ctx.canvas.height);
        ctx.beginPath();
        ctx.moveTo(radius, 0)
        for (let i=0; i<=5; i++) {
        ctx.lineTo(radius*Math.cos(i*angle), radius*Math.sin(i*angle));
        //ctx.closePath();
        ctx.strokeStyle = 'rgba(0, 0, 0, '+alpha+')'
        ctx.stroke();
        }
    }
    
    function grid(radius, alpha, angle) {
        ctx.beginPath();
        for (let i=0; i<=5; i++) {
        ctx.lineTo(radius*Math.cos(i*angle), radius*Math.sin(i*angle));
        ctx.moveTo(0,0);
        ctx.strokeStyle = 'rgba(0, 0, 0, '+alpha+')'
        ctx.stroke();
        }
    }
    
    function shape(values,size,alpha,angle,thick) {
        ctx.beginPath();
        ctx.lineWidth = thick;
        for (let i=0; i<  values.length; i++) {
            ctx.lineTo(values[i]*size*Math.cos(i*angle),values[i]*size*Math.sin(i*angle));
        }   
        ctx.closePath();
        ctx.strokeStyle = 'rgba(0, 0, 0, '+alpha+')'
        ctx.stroke();
    }

    
    function setBackground() {
        let factor = [1, 0.8, 0.6, 0.4, 0.2];
        for (let i=0; i<=factor.length; i++) {
        background(radius*factor[i], factor[i]/2, angle, 0.01)
        }
        grid(radius*2, 0.1, angle)
    }

      
    function getRan(min,max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min +1)) + min;
    }

    total = getRan(20,100)

    function rotate(speed) {
    move += speed;
    }
    function drawLoop() {
        background(radius, 0.3, move, (0.2/Nscore));
        shape(qValues[0], size, 0.7, angle, 1);
        shape(qValues[1], size, 0.7, angle, 1);
        shape(qValues[2], size, 0.7, angle, 1);
        shape(qValues[3], size, 0.7, angle, 1);
        ctx.rotate(0.1*Cscore)
        rotate((Oscore+Cscore+Escore+Ascore+Nscore));
        radius = radius+(0.02*Oscore);
        size = size-(0.002*Escore);
        //num = num+10
        //if (num <= 900) {
        //timeout = 1000-num}
        setTimeout(drawLoop,33)
        //window.requestAnimationFrame(drawLoop);
    }
</script>

<script type="module">
    ///////////////////////////////////////////// SOUND  
    
    let micEnv

    document.getElementById("submit").onclick =
        async function startLoops() {
            const mic = new Tone.UserMedia(-3);
            const miccomp = new Tone.Compressor(-6,20)
            //sTone.Master.volume.value = -6

            //mic.open()
            //await tabulateAnswers();
            //console.log(Oscore, Cscore, Escore, Ascore, Nscore)

            const compout = new Tone.Compressor (-24, 4)
            const gainout = new Tone.Gain(.9).toDestination();

            mic.open()
            
            const Env = new Tone.AmplitudeEnvelope({
                attack: 4,
                decay: 1,
                sustain: 1,
                release: 0.2
            });

            mic.connect(miccomp);
            //miccomp.connect(Env)
            const noise = new Tone.Noise("pink").start();
            const noisegain = new Tone.Gain(0.05);
            noise.connect(noisegain);
            noisegain.connect(Env);
            

            //class - functions for voices makevoice(effect)?? 
            //3d spatialisation - binaural - make the listener move ??? 0/0/0 is listener position
            //fft / filter bank mit envelope follower um frequenzbänder besser zu kontrollieren
            
            const delayTimes = [1,1,1,1,1]
            const positions = [0,0,0,0,0]
            function getRndInteger(min, max) {
                return Math.floor(Math.random() * (max - min + 1) ) + min;
            }
          
            function makeLoop(fx, dly, p, speed) {
                const gain = new Tone.Gain(0.9);
                const filter = new Tone.Filter(speed*200, "lowpass")
                const delay = new Tone.Delay(dly,10);
                const comp = new Tone.Compressor(-24, 4);
                const pos = new Tone.Panner(p);
                const lfo = new Tone.LFO({
                    frequency: 0.005*speed, 
                    min: -p/2, 
                    max: p/2,
                    phase: 360/speed,
                    type: "sine"
                }).start();
                const lfo2 = new Tone.LFO({
                    frequency: 0.001*speed, 
                    min: 0.0, 
                    max: 0.001,
                    phase: 360/speed,
                    type: "sine"
                }).start();
                const lfo3 = new Tone.LFO({
                    frequency: 0.1*speed, 
                    min: dly, 
                    max: dly*2,
                    phase: 180/speed,
                    type: "triangle"
                }).start();
                
                
                Env.connect(gain);
                xfeedgain.connect(gain);
                gain.connect(comp);
                comp.connect(fx);
                fx.connect(delay);
                delay.connect(gain);
                gain.connect(pos);
                pos.connect(filterout);
                lfo.connect(pos.pan);
                lfo2.connect(lfo3.frequency)
                lfo3.connect(delay.delayTime)
            }

            const chorus = new Tone.Chorus(20, 20, 5);
            const pitchdown = new Tone.PitchShift(-1);
            const shift = new Tone.FrequencyShifter(0.5);
            const pitchup = new Tone.PitchShift(+1);
            const autofilt = new Tone.AutoFilter({
                frequency: 0.01, 
                baseFrequency: 200, 
                octaves: 1,
            })
            const lfo2 = new Tone.LFO({
                    frequency: 0.1*Ascore, 
                    min: 0, 
                    max: 0.005,
                    phase: 360/Ascore,
                    type: "sine"
                }).start();

            const effects = [chorus, shift, pitchdown, pitchup, autofilt]

            const xfeed = new Tone.Delay(20, 30)
            const xfeedgain = new Tone.Gain(0.001)
            const filterout = new Tone.Filter(30, "highpass")

            const rev = new Tone.Reverb({
                decay: 2, 
                wet: 0.7});
            lfo2.connect(xfeedgain.gain);            
            filterout.connect(compout);
            compout.connect(xfeed);
            xfeed.connect(xfeedgain);
            filterout.connect(rev);
            rev.connect(gainout);
 
            function setParameters() {
                //setInterval?
                delayTimes[0] = Math.random()*Oscore*0.5;
                positions[0] = Oscore
                chorus.frequency.rampTo(0.1*Oscore)
                chorus.delayTime = (Oscore)**2;
                chorus.depth = Oscore/4;
                
                shift.frequency = (12.5-Cscore)**2;
                delayTimes[1] = Math.random()*Cscore*0.5;
                positions[1] = Cscore

                delayTimes[2] = Math.random()*Escore*0.5;
                pitchdown.pitch = -0.05*Escore;
                positions[2] = -Escore
                
                pitchup.pitch = Ascore/2;
                delayTimes[3] = Math.random()*Ascore*0.5;
                positions[3] = Ascore

                autofilt.baseFrequency = (2000/Nscore);
                autofilt.frequency.rampTo(0.01*(Nscore**3));
                autofilt.octaves = Nscore/4;
                delayTimes[4] = Math.random()*Nscore*0.5;
                positions[4] = Nscore
            }
            let scores = [Oscore, Cscore, Escore, Ascore, Nscore]
            console.log(Oscore, Cscore, Escore, Ascore, Nscore)
            
            setParameters();
            let i
            //makeLoop(effects[4], delayTimes[4], ((scores[4]-12,5)/10), scores[4])
            
            for (i=0; i<5; i++) {
                makeLoop(effects[i], delayTimes[i], ((scores[i]-12,5)/10), scores[4-i])
            }
            //setParameters();
            
            Env.triggerAttackRelease((Oscore+Cscore+Escore+Ascore+Nscore)/40);
            
            drawLoop();            

            document.getElementById("submit").style.display = "none";
            document.getElementById("reset").style.display = "inline";
            
            function stopThings() {
                gainout.gain.rampTo(0, 10);
                setTimeout(window.location.reload.bind(window.location), 10000)
            }

            setTimeout(stopThings,300000)
            //netlify
        }    
    </script>

</html>